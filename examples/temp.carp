;;(Project.config "echo-compiler-cmd" true)
;; (load "Debug.carp")
;; (Debug.sanitize-addresses)
(Project.config "print-ast" true)

(deftype Enemy [hp Int
                attack (Fn [Enemy] Enemy)])

(defn fire [e]
  (Enemy.update-hp e dec))

(defn attack [attacker target]
  (let [f (unsafe-deref (Enemy.attack attacker))]
    (f target)))

(defn main []
  (let [enemy (Enemy.init 100 fire)
        hero (Enemy.init 100 fire)]
    (println* &(attack &enemy hero))))
